{"version":3,"sources":["debug_commands/sandbox.js"],"names":["HOME_APP_JSON","expo","name","description","slug","privacy","sdkVersion","version","orientation","platforms","primaryColor","icon","updates","checkAutomatically","fallbackToCacheTimeout","ios","supportsTablet","bundleIdentifier","publishBundlePath","config","actualBundleIdentifier","android","package","scheme","isKernel","kernel","iosManifestPath","androidManifestPath","extra","amplitudeApiKey","HOME_PKG_JSON","main","private","scripts","test","author","license","jest","preset","powertools","group","dependencies","dedent","immutable","lodash","querystring","react","redux","url","devDependencies","hashids","uuid","program","command","alias","option","asyncAction","options","ensureLoggedInAsync","user","username","normalizedUsername","replace","getAsync","sandboxBundleId","randomIdentifier","mergeAsync","type","releaseChannel","hardcodeRevisionId","projectDir","join","dotExpoHomeDirectory","sync","modifiedAppJSON","writeFileSync","iosBuilder"],"mappings":"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","file":"../../debug_commands/sandbox.js","sourcesContent":["/**\n * @flow\n */\n\nimport { User, UserSettings, UrlUtils } from 'xdl';\nimport path from 'path';\nimport rimraf from 'rimraf';\nimport mkdirp from 'mkdirp';\nimport fs from 'fs';\n\nimport IOSBuilder from '../commands/build/IOSBuilder';\n\nconst HOME_APP_JSON = {\n  expo: {\n    name: 'expo-home',\n    description: '',\n    slug: 'home',\n    privacy: 'unlisted',\n\n    // When publishing the sdkVersion needs to be set to the target sdkVersion.\n    // The Exponent client will load it as UNVERSIONED, but the server uses this field\n    // to know which clients to serve the bundle to.\n    sdkVersion: '26.0.0',\n\n    // Update this each time you publish so you're able to relate published\n    // bundles to specific commits in the repo\n    version: '26.1.0',\n\n    orientation: 'portrait',\n    platforms: ['ios', 'android'],\n    primaryColor: '#cccccc',\n    icon: 'https://s3.amazonaws.com/exp-brand-assets/ExponentEmptyManifest_192.png',\n    updates: {\n      checkAutomatically: 'ON_LOAD',\n      fallbackToCacheTimeout: 0,\n    },\n\n    ios: {\n      supportsTablet: true,\n      bundleIdentifier: 'host.exp.exponent',\n      publishBundlePath: '../ios/Exponent/Supporting/kernel.ios.bundle',\n      config: {\n        actualBundleIdentifier: 'REPLACEME',\n      },\n    },\n    android: {\n      package: 'host.exp.exponent',\n      publishBundlePath: '../android/app/src/main/assets/kernel.android.bundle',\n    },\n    scheme: 'exp',\n    isKernel: true,\n    kernel: {\n      iosManifestPath: '../ios/Exponent/Supporting/kernel-manifest.json',\n      androidManifestPath: '../android/app/src/main/assets/kernel-manifest.json',\n    },\n    extra: {\n      amplitudeApiKey: '081e5ec53f869b440b225d5e40ec73f9',\n    },\n  },\n};\n\nconst HOME_PKG_JSON = {\n  main: 'node_modules/expo/AppEntry.js',\n  private: true,\n  description: 'The Expo app',\n  scripts: {\n    test: 'jest',\n  },\n  author: '650 Industries',\n  license: 'Copyright 650 Industries, Inc. All rights reserved.',\n  jest: {\n    preset: 'jest-expo',\n  },\n  powertools: {\n    group: 'client',\n  },\n  dependencies: {\n    '@expo/ex-navigation': '^2.11.1',\n    '@expo/react-native-action-sheet': '^0.3.0',\n    '@expo/react-native-fade-in-image': '^1.1.1',\n    '@expo/react-native-navigator': '0.5.2',\n    '@expo/react-native-responsive-image': '^1.2.1',\n    '@expo/react-native-touchable-native-feedback-safe': '^1.1.1',\n    'apollo-client': '~1.0.3',\n    'autobind-decorator': '^1.3.2',\n    dedent: '^0.7.0',\n    'es6-error': '^4.0.1',\n    expo: '26.0.0-rc.2',\n    'graphql-tag': '^1.2.1',\n    immutable: '^3.8.1',\n    'jwt-decode': '^2.1.0',\n    lodash: '^4.17.4',\n    'prop-types': '^15.5.10',\n    querystring: '^0.2.0',\n    react: '16.2.0',\n    'react-apollo': '~1.0.1',\n    'react-mixin': '^3.0.4',\n    'react-native': 'expo/react-native#sdk-26',\n    'react-native-deprecated-custom-components': '^0.1.0',\n    'react-native-infinite-scroll-view': '^0.4.2',\n    'react-redux': '^5.0.1',\n    'react-timer-mixin': '^0.13.3',\n    redux: '^3.5.1',\n    'redux-thunk': '^2.2.0',\n    url: '^0.11.0',\n  },\n  devDependencies: {\n    hashids: '^1.1.1',\n    'jest-expo': '^25.1.0',\n    'jsc-android': '^216113.0.0',\n    'node-fetch': '^2.0.0',\n    uuid: '^3.0.1',\n  },\n};\n\nexport default (program: any) => {\n  program\n    .command('sandbox:ios')\n    .alias('si')\n    .option('-c, --clear-credentials', 'Clear credentials stored on expo servers')\n    .option('-e, --apple-enterprise-account', 'Run as Apple Enterprise account')\n    .option('--no-wait', 'Exit immediately after triggering build.')\n    .description('Build a signed IPA of the Expo sandbox app')\n    .asyncAction(async options => {\n      const user = await User.ensureLoggedInAsync();\n      const { username } = user;\n      let normalizedUsername = username.replace(/[^0-9a-zA-Z]/g, '');\n\n      let sandboxBundleId = await UserSettings.getAsync('sandboxBundleId', null);\n      if (!sandboxBundleId) {\n        sandboxBundleId = UrlUtils.randomIdentifier(5);\n        await UserSettings.mergeAsync({ sandboxBundleId });\n      }\n\n      options.type = 'client';\n      options.releaseChannel = 'default';\n      options.hardcodeRevisionId = 'eb310d00-2af3-11e8-9906-3ba982c41215';\n\n      let projectDir = path.join(UserSettings.dotExpoHomeDirectory(), 'expo-home');\n      rimraf.sync(projectDir);\n      mkdirp.sync(projectDir);\n\n      let modifiedAppJSON = HOME_APP_JSON;\n      modifiedAppJSON.expo.ios.bundleIdentifier = `host.exp.${normalizedUsername}-${sandboxBundleId}`;\n      modifiedAppJSON.expo.ios.config.actualBundleIdentifier =\n        modifiedAppJSON.expo.ios.bundleIdentifier;\n      fs.writeFileSync(path.join(projectDir, 'app.json'), JSON.stringify(modifiedAppJSON));\n      fs.writeFileSync(path.join(projectDir, 'package.json'), JSON.stringify(HOME_PKG_JSON));\n\n      const iosBuilder = new IOSBuilder(projectDir, options);\n      return iosBuilder.command();\n    });\n};\n"],"sourceRoot":"/exp@57.2.1/src"}