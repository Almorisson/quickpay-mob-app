"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const estraverse_1 = require("estraverse");
const scope_1 = require("./scope");
const variable_1 = require("../variable");
const definition_1 = require("../definition");
class GlobalScope extends scope_1.Scope {
    constructor(scopeManager, block) {
        super(scopeManager, "global", null, block, false);
        this.implicit = {
            set: new Map(),
            variables: [],
            left: [],
        };
    }
    __close(scopeManager) {
        const implicit = [];
        for (let i = 0, iz = this.__left.length; i < iz; ++i) {
            const ref = this.__left[i];
            if (ref.maybeImplicitGlobal &&
                !this.set.has(ref.identifier.name)) {
                implicit.push(ref.maybeImplicitGlobal);
            }
        }
        for (let i = 0, iz = implicit.length; i < iz; ++i) {
            const info = implicit[i];
            this.__defineImplicit(info.pattern, new definition_1.Definition(variable_1.VariableType.ImplicitGlobalVariable, info.pattern, info.node));
        }
        this.implicit.left = this.__left;
        return super.__close(scopeManager);
    }
    __defineImplicit(node, def) {
        if (node && node.type === estraverse_1.Syntax.Identifier) {
            this.__defineGeneric(node.name, this.implicit.set, this.implicit.variables, node, def);
        }
    }
}
exports.GlobalScope = GlobalScope;
//# sourceMappingURL=globalScope.js.map