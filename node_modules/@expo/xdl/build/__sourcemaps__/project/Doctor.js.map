{"version":3,"sources":["project/Doctor.js"],"names":["NO_ISSUES","WARNING","ERROR","FATAL","MIN_WATCHMAN_VERSION","MIN_NPM_VERSION","CORRECT_NPM_VERSION","WARN_NPM_VERSION_RANGES","BAD_NPM_VERSION_RANGES","_isNpmVersionWithinRanges","npmVersion","ranges","_","some","range","semver","satisfies","async","_checkNpmVersionAsync","projectRoot","await","Binaries","sourceBashLoginScriptsAsync","let","yarnVersionResponse","spawnAsync","status","e","npmVersionResponse","trim","stdout","lt","ProjectUtils","logError","logWarning","clearNotification","_checkWatchmanVersionAsync","Watchman","isPlatformSupported","watchmanVersion","unblockAndGetVersionAsync","warningMessage","process","platform","validateWithSchemaFileAsync","schemaPath","exp","readConfigJsonAsync","schema","JSON","parse","fs","readFile","validateWithSchema","configName","sdkVersion","validateAssets","schemaErrorMessage","assetsErrorMessage","validator","Schemer","rootDir","validateSchemaAsync","SchemerError","errors","length","map","formatValidationError","join","validateAssetsAsync","Config","helpUrl","validationError","fieldPath","message","_validateExpJsonAsync","pkg","allowNetwork","expJsonExists","ConfigUtils","fileExistsAsync","path","appJsonExists","configFilenameAsync","env","EXPO_SKIP_MANIFEST_VALIDATION_TOKEN","ExpSchema","getSchemaAsync","sdkVersions","Versions","sdkVersionsAsync","keys","reactNativeIssue","_validateReactNativeVersionAsync","validation","reactNativeVersionWarnings","reactNative","dependencies","isDetached","test","reactNativeTag","match","sdkVersionObject","major","parseSdkVersionFromTag","_validateNodeModulesAsync","nodeModulesPath","resolve","result","statSync","isDirectory","resolveModule","code","_validateOptimizedAssetsAsync","hasUnoptimized","AssetUtils","hasUnoptimizedAssetsAsync","validateLowLatencyAsync","validateAsync","validateWithNetworkAsync","hasWebSupportAsync","inputExp","platforms","Array","isArray","isWebConfigured","includes","getWebSetupLogs","appJsonRules","chalk","green","bold","red","validateWebSupportAsync","isInteractive","isTTY","validateWebPlatformAddedAsync","boolean","hasWebSupport","promptToAddWebPlatform","addPlatform","XDLError","promptAsync","question","type","name","default","should","inquirer","prompt","underline","getenv","boolish","expStatus","Math","max","ignoreNodeModulesValidation","nodeModulesStatus","EXPO_SDK_INSTALLED_AND_IMPORTED","EXPO_SDK_NOT_INSTALLED","EXPO_SDK_NOT_IMPORTED","getExpoSdkStatus","sdkPkg","mainFilePath","main","mainFile"],"mappings":"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","file":"../../project/Doctor.js","sourcesContent":["/**\n * @flow\n */\n\nimport _ from 'lodash';\nimport semver from 'semver';\nimport fs from 'fs-extra';\nimport getenv from 'getenv';\nimport path from 'path';\nimport spawnAsync from '@expo/spawn-async';\nimport * as ConfigUtils from '@expo/config';\n\nimport chalk from 'chalk';\nimport inquirer from 'inquirer';\nimport Schemer, { SchemerError } from '@expo/schemer';\n\nimport * as ExpSchema from './ExpSchema';\nimport * as ProjectUtils from './ProjectUtils';\nimport * as AssetUtils from '../AssetUtils';\nimport * as Binaries from '../Binaries';\nimport Config from '../Config';\nimport * as Versions from '../Versions';\nimport * as Watchman from '../Watchman';\nimport XDLError from '../XDLError';\n\nexport const NO_ISSUES = 0;\nexport const WARNING = 1;\nexport const ERROR = 2;\nexport const FATAL = 3;\n\nconst MIN_WATCHMAN_VERSION = '4.6.0';\nconst MIN_NPM_VERSION = '3.0.0';\nconst CORRECT_NPM_VERSION = 'latest';\nconst WARN_NPM_VERSION_RANGES = ['>= 5.0.0 < 5.7.0'];\nconst BAD_NPM_VERSION_RANGES = ['>= 5.0.0 <= 5.0.3'];\n\nfunction _isNpmVersionWithinRanges(npmVersion, ranges) {\n  return _.some(ranges, range => semver.satisfies(npmVersion, range));\n}\n\nasync function _checkNpmVersionAsync(projectRoot) {\n  try {\n    await Binaries.sourceBashLoginScriptsAsync();\n\n    try {\n      let yarnVersionResponse = await spawnAsync('yarnpkg', ['--version']);\n      if (yarnVersionResponse.status === 0) {\n        return NO_ISSUES;\n      }\n    } catch (e) {}\n\n    let npmVersionResponse = await spawnAsync('npm', ['--version']);\n    let npmVersion = _.trim(npmVersionResponse.stdout);\n\n    if (\n      semver.lt(npmVersion, MIN_NPM_VERSION) ||\n      _isNpmVersionWithinRanges(npmVersion, BAD_NPM_VERSION_RANGES)\n    ) {\n      ProjectUtils.logError(\n        projectRoot,\n        'expo',\n        `Error: You are using npm version ${npmVersion}. We recommend the latest version ${CORRECT_NPM_VERSION}. To install it, run 'npm i -g npm@${CORRECT_NPM_VERSION}'.`,\n        'doctor-npm-version'\n      );\n      return WARNING;\n    } else if (_isNpmVersionWithinRanges(npmVersion, WARN_NPM_VERSION_RANGES)) {\n      ProjectUtils.logWarning(\n        projectRoot,\n        'expo',\n        `Warning: You are using npm version ${npmVersion}. There may be bugs in this version, use it at your own risk. We recommend version ${CORRECT_NPM_VERSION}.`,\n        'doctor-npm-version'\n      );\n    } else {\n      ProjectUtils.clearNotification(projectRoot, 'doctor-npm-version');\n    }\n  } catch (e) {\n    ProjectUtils.logWarning(\n      projectRoot,\n      'expo',\n      `Warning: Could not determine npm version. Make sure your version is >= ${MIN_NPM_VERSION} - we recommend ${CORRECT_NPM_VERSION}.`,\n      'doctor-npm-version'\n    );\n    return WARNING;\n  }\n\n  return NO_ISSUES;\n}\n\nasync function _checkWatchmanVersionAsync(projectRoot) {\n  // There's no point in checking any of this stuff if watchman isn't supported on this platform\n  if (!Watchman.isPlatformSupported()) {\n    ProjectUtils.clearNotification(projectRoot, 'doctor-watchman-version');\n    return;\n  }\n\n  let watchmanVersion = await Watchman.unblockAndGetVersionAsync(projectRoot);\n\n  // If we can't get the watchman version, `getVersionAsync` will return `null`\n  if (!watchmanVersion) {\n    // watchman is probably just not installed\n    ProjectUtils.clearNotification(projectRoot, 'doctor-watchman-version');\n    return;\n  }\n\n  if (semver.lt(watchmanVersion, MIN_WATCHMAN_VERSION)) {\n    let warningMessage = `Warning: You are using an old version of watchman (v${watchmanVersion}). This may cause problems for you.\\n\\nWe recommend that you either uninstall watchman (and XDE will try to use a copy it is bundled with) or upgrade watchman to a newer version, at least v${MIN_WATCHMAN_VERSION}.`;\n\n    // Add a note about homebrew if the user is on a Mac\n    if (process.platform === 'darwin') {\n      warningMessage += `\\n\\nIf you are using homebrew, try:\\nbrew uninstall watchman; brew install watchman`;\n    }\n    ProjectUtils.logWarning(projectRoot, 'expo', warningMessage, 'doctor-watchman-version');\n  } else {\n    ProjectUtils.clearNotification(projectRoot, 'doctor-watchman-version');\n  }\n}\n\nexport async function validateWithSchemaFileAsync(\n  projectRoot: string,\n  schemaPath: string\n): Promise<{ schemaErrorMessage: ?string, assetsErrorMessage: ?string }> {\n  let { exp } = await ProjectUtils.readConfigJsonAsync(projectRoot);\n  let schema = JSON.parse(await fs.readFile(schemaPath, 'utf8'));\n  return validateWithSchema(projectRoot, exp, schema.schema, 'exp.json', 'UNVERSIONED', true);\n}\n\nexport async function validateWithSchema(\n  projectRoot: string,\n  exp: any,\n  schema: any,\n  configName: string,\n  sdkVersion: string,\n  validateAssets: boolean\n): Promise<{ schemaErrorMessage: ?string, assetsErrorMessage: ?string }> {\n  let schemaErrorMessage;\n  let assetsErrorMessage;\n  let validator = new Schemer(schema, { rootDir: projectRoot });\n\n  // Validate the schema itself\n  try {\n    await validator.validateSchemaAsync(exp);\n  } catch (e) {\n    if (e instanceof SchemerError) {\n      schemaErrorMessage = `Error: Problem${\n        e.errors.length > 1 ? 's' : ''\n      } validating fields in ${configName}. See https://docs.expo.io/versions/v${sdkVersion}/workflow/configuration/`;\n      schemaErrorMessage += e.errors.map(formatValidationError).join('');\n    }\n  }\n\n  if (validateAssets) {\n    try {\n      await validator.validateAssetsAsync(exp);\n    } catch (e) {\n      if (e instanceof SchemerError) {\n        assetsErrorMessage = `Error: Problem${\n          e.errors.length > 1 ? '' : 's'\n        } validating asset fields in ${configName}. See ${Config.helpUrl}`;\n        assetsErrorMessage += e.errors.map(formatValidationError).join('');\n      }\n    }\n  }\n  return { schemaErrorMessage, assetsErrorMessage };\n}\n\nfunction formatValidationError(validationError) {\n  return `\\n • ${validationError.fieldPath ? 'Field: ' + validationError.fieldPath + ' - ' : ''}${\n    validationError.message\n  }.`;\n}\n\nasync function _validateExpJsonAsync(exp, pkg, projectRoot, allowNetwork): Promise<number> {\n  if (!exp || !pkg) {\n    // readConfigJsonAsync already logged an error\n    return FATAL;\n  }\n\n  try {\n    await _checkWatchmanVersionAsync(projectRoot);\n  } catch (e) {\n    ProjectUtils.logWarning(\n      projectRoot,\n      'expo',\n      `Warning: Problem checking watchman version. ${e.message}.`,\n      'doctor-problem-checking-watchman-version'\n    );\n  }\n  ProjectUtils.clearNotification(projectRoot, 'doctor-problem-checking-watchman-version');\n\n  const expJsonExists = await ConfigUtils.fileExistsAsync(path.join(projectRoot, 'exp.json'));\n  const appJsonExists = await ConfigUtils.fileExistsAsync(path.join(projectRoot, 'app.json'));\n\n  if (expJsonExists && appJsonExists) {\n    ProjectUtils.logWarning(\n      projectRoot,\n      'expo',\n      `Warning: Both app.json and exp.json exist in this directory. Only one should exist for a single project.`,\n      'doctor-both-app-and-exp-json'\n    );\n    return WARNING;\n  }\n  ProjectUtils.clearNotification(projectRoot, 'doctor-both-app-and-exp-json');\n\n  let sdkVersion = exp.sdkVersion;\n  const configName = await ConfigUtils.configFilenameAsync(projectRoot);\n\n  // Skip validation if the correct token is set in env\n  if (!(sdkVersion === 'UNVERSIONED' && process.env.EXPO_SKIP_MANIFEST_VALIDATION_TOKEN)) {\n    try {\n      let schema = await ExpSchema.getSchemaAsync(sdkVersion);\n      let { schemaErrorMessage, assetsErrorMessage } = await validateWithSchema(\n        projectRoot,\n        exp,\n        schema,\n        configName,\n        sdkVersion,\n        allowNetwork\n      );\n\n      if (schemaErrorMessage) {\n        ProjectUtils.logError(projectRoot, 'expo', schemaErrorMessage, 'doctor-schema-validation');\n      } else {\n        ProjectUtils.clearNotification(projectRoot, 'doctor-schema-validation');\n      }\n      if (assetsErrorMessage) {\n        ProjectUtils.logError(\n          projectRoot,\n          'expo',\n          assetsErrorMessage,\n          `doctor-validate-asset-fields`\n        );\n      } else {\n        ProjectUtils.clearNotification(projectRoot, `doctor-validate-asset-fields`);\n      }\n      ProjectUtils.clearNotification(projectRoot, 'doctor-schema-validation-exception');\n      if (schemaErrorMessage || assetsErrorMessage) return ERROR;\n    } catch (e) {\n      ProjectUtils.logWarning(\n        projectRoot,\n        'expo',\n        `Warning: Problem validating ${configName}: ${e.message}.`,\n        'doctor-schema-validation-exception'\n      );\n    }\n  }\n\n  // Warn if sdkVersion is UNVERSIONED\n  if (sdkVersion === 'UNVERSIONED' && !process.env.EXPO_SKIP_MANIFEST_VALIDATION_TOKEN) {\n    ProjectUtils.logError(\n      projectRoot,\n      'expo',\n      `Error: Using unversioned Expo SDK. Do not publish until you set sdkVersion in ${configName}`,\n      'doctor-unversioned'\n    );\n    return ERROR;\n  }\n  ProjectUtils.clearNotification(projectRoot, 'doctor-unversioned');\n\n  let sdkVersions = await Versions.sdkVersionsAsync();\n  if (!sdkVersions) {\n    ProjectUtils.logError(\n      projectRoot,\n      'expo',\n      `Error: Couldn't connect to SDK versions server`,\n      'doctor-versions-endpoint-failed'\n    );\n    return ERROR;\n  }\n  ProjectUtils.clearNotification(projectRoot, 'doctor-versions-endpoint-failed');\n\n  if (!sdkVersions[sdkVersion]) {\n    ProjectUtils.logError(\n      projectRoot,\n      'expo',\n      `Error: Invalid sdkVersion. Valid options are ${_.keys(sdkVersions).join(', ')}`,\n      'doctor-invalid-sdk-version'\n    );\n    return ERROR;\n  }\n  ProjectUtils.clearNotification(projectRoot, 'doctor-invalid-sdk-version');\n\n  const reactNativeIssue = await _validateReactNativeVersionAsync(\n    exp,\n    pkg,\n    projectRoot,\n    sdkVersions,\n    sdkVersion\n  );\n\n  if (reactNativeIssue !== NO_ISSUES) {\n    return reactNativeIssue;\n  }\n\n  // TODO: Check any native module versions here\n\n  return NO_ISSUES;\n}\n\nasync function _validateReactNativeVersionAsync(\n  exp,\n  pkg,\n  projectRoot,\n  sdkVersions,\n  sdkVersion\n): Promise<number> {\n  if (Config.validation.reactNativeVersionWarnings) {\n    let reactNative = pkg.dependencies ? pkg.dependencies['react-native'] : null;\n\n    // react-native is required\n    if (!reactNative) {\n      ProjectUtils.logError(\n        projectRoot,\n        'expo',\n        `Error: Can't find react-native in package.json dependencies`,\n        'doctor-no-react-native-in-package-json'\n      );\n      return ERROR;\n    }\n    ProjectUtils.clearNotification(projectRoot, 'doctor-no-react-native-in-package-json');\n\n    if (!exp.isDetached) {\n      return NO_ISSUES;\n\n      // (TODO-2017-07-20): Validate the react-native version if it uses\n      // officially published package rather than Expo fork. Expo fork of\n      // react-native was required before CRNA. We now only run the react-native\n      // validation of the version if we are using the fork. We should probably\n      // validate the version here as well such that it matches with the\n      // react-native version compatible with the selected SDK.\n    }\n\n    // Expo fork of react-native is required\n    if (!/expo\\/react-native/.test(reactNative)) {\n      ProjectUtils.logWarning(\n        projectRoot,\n        'expo',\n        `Warning: Not using the Expo fork of react-native. See ${Config.helpUrl}.`,\n        'doctor-not-using-expo-fork'\n      );\n      return WARNING;\n    }\n    ProjectUtils.clearNotification(projectRoot, 'doctor-not-using-expo-fork');\n\n    try {\n      let reactNativeTag = reactNative.match(/sdk-\\d+\\.\\d+\\.\\d+/)[0];\n      let sdkVersionObject = sdkVersions[sdkVersion];\n\n      // TODO: Want to be smarter about this. Maybe warn if there's a newer version.\n      if (\n        semver.major(Versions.parseSdkVersionFromTag(reactNativeTag)) !==\n        semver.major(Versions.parseSdkVersionFromTag(sdkVersionObject['expoReactNativeTag']))\n      ) {\n        ProjectUtils.logWarning(\n          projectRoot,\n          'expo',\n          `Warning: Invalid version of react-native for sdkVersion ${sdkVersion}. Use github:expo/react-native#${\n            sdkVersionObject['expoReactNativeTag']\n          }`,\n          'doctor-invalid-version-of-react-native'\n        );\n        return WARNING;\n      }\n      ProjectUtils.clearNotification(projectRoot, 'doctor-invalid-version-of-react-native');\n\n      ProjectUtils.clearNotification(projectRoot, 'doctor-malformed-version-of-react-native');\n    } catch (e) {\n      ProjectUtils.logWarning(\n        projectRoot,\n        'expo',\n        `Warning: ${reactNative} is not a valid version. Version must be in the form of sdk-x.y.z. Please update your package.json file.`,\n        'doctor-malformed-version-of-react-native'\n      );\n      return WARNING;\n    }\n  }\n\n  return NO_ISSUES;\n}\n\nasync function _validateNodeModulesAsync(projectRoot): Promise<number> {\n  let { exp } = await ProjectUtils.readConfigJsonAsync(projectRoot);\n  let nodeModulesPath = projectRoot;\n  if (exp.nodeModulesPath) {\n    nodeModulesPath = path.resolve(projectRoot, exp.nodeModulesPath);\n  }\n\n  // Check to make sure node_modules exists at all\n  try {\n    let result = fs.statSync(path.join(nodeModulesPath, 'node_modules'));\n    if (!result.isDirectory()) {\n      ProjectUtils.logError(\n        projectRoot,\n        'expo',\n        `Error: node_modules directory is missing. Please run \\`npm install\\` in your project directory.`,\n        'doctor-node-modules-missing'\n      );\n      return FATAL;\n    }\n\n    ProjectUtils.clearNotification(projectRoot, 'doctor-node-modules-missing');\n  } catch (e) {\n    ProjectUtils.logError(\n      projectRoot,\n      'expo',\n      `Error: node_modules directory is missing. Please run \\`npm install\\` in your project directory.`,\n      'doctor-node-modules-missing'\n    );\n    return FATAL;\n  }\n\n  // Check to make sure react native is installed\n  try {\n    ConfigUtils.resolveModule('react-native/local-cli/cli.js', projectRoot, exp);\n    ProjectUtils.clearNotification(projectRoot, 'doctor-react-native-not-installed');\n  } catch (e) {\n    if (e.code === 'MODULE_NOT_FOUND') {\n      ProjectUtils.logError(\n        projectRoot,\n        'expo',\n        `Error: React Native is not installed. Please run \\`npm install\\` in your project directory.`,\n        'doctor-react-native-not-installed'\n      );\n      return FATAL;\n    } else {\n      throw e;\n    }\n  }\n  return NO_ISSUES;\n}\n\nasync function _validateOptimizedAssetsAsync(projectRoot: string): void {\n  const hasUnoptimized = await AssetUtils.hasUnoptimizedAssetsAsync(projectRoot);\n  if (hasUnoptimized) {\n    ProjectUtils.logWarning(\n      projectRoot,\n      'expo',\n      `Warning: This project contains unoptimized assets. Please run \\`expo optimize\\` in your project directory.`,\n      'doctor-unoptimized-assets'\n    );\n  } else {\n    ProjectUtils.clearNotification(projectRoot, 'doctor-unoptimized-assets');\n  }\n}\n\nexport async function validateLowLatencyAsync(projectRoot: string): Promise<number> {\n  return validateAsync(projectRoot, false);\n}\n\nexport async function validateWithNetworkAsync(projectRoot: string): Promise<number> {\n  return validateAsync(projectRoot, true);\n}\n\nexport async function hasWebSupportAsync(projectRoot, exp) {\n  let inputExp = exp;\n  if (!exp) {\n    inputExp = (await ProjectUtils.readConfigJsonAsync(projectRoot)).exp;\n  }\n  const { platforms } = inputExp;\n  if (!Array.isArray(platforms)) {\n    return false;\n  }\n\n  const isWebConfigured = platforms.includes('web');\n  return isWebConfigured;\n}\n\nfunction getWebSetupLogs(): string {\n  const appJsonRules = chalk.green(`\n  {\n    \"platforms\": [\n  ${chalk.green.bold(`+      \"web\"`)}\n    ]\n  }`);\n  return `${chalk.red(\n    `* Add \"web\" to the \"platforms\" array in your project's ${chalk.bold(`app.json`)}`\n  )} ${appJsonRules}`;\n}\n\nexport async function validateWebSupportAsync(projectRoot) {\n  const isInteractive = process.stdout.isTTY;\n\n  await validateWebPlatformAddedAsync(projectRoot, isInteractive);\n\n  // TODO: Bacon: Add package validation\n}\n\nexport async function validateWebPlatformAddedAsync(\n  projectRoot: string,\n  isInteractive: boolean = true\n): Promise<void> {\n  const hasWebSupport = await hasWebSupportAsync(projectRoot);\n  if (hasWebSupport) {\n    return true;\n  }\n\n  if (isInteractive && (await promptToAddWebPlatform())) {\n    await ConfigUtils.addPlatform(projectRoot, 'web');\n    return true;\n  }\n  throw new XDLError('WEB_NOT_CONFIGURED', getWebSetupLogs());\n}\n\nasync function promptAsync(message: string): Promise<boolean> {\n  const question = {\n    type: 'confirm',\n    name: 'should',\n    message,\n    default: true,\n  };\n  const { should } = await inquirer.prompt(question);\n  return should;\n}\n\nasync function promptToAddWebPlatform(): Promise<boolean> {\n  return await promptAsync(\n    `It appears you don't explicitly define \"${chalk.green.underline(\n      `web`\n    )}\" as one of the supported \"${chalk.green.underline(\n      `platforms`\n    )}\" in your project's ${chalk.green(`app.json`)}. \\n  Would you like to add it?`\n  );\n}\n\nasync function validateAsync(projectRoot: string, allowNetwork: boolean): Promise<number> {\n  if (getenv.boolish('EXPO_NO_DOCTOR', false)) {\n    return NO_ISSUES;\n  }\n\n  let { exp, pkg } = await ProjectUtils.readConfigJsonAsync(projectRoot);\n\n  let status = await _checkNpmVersionAsync(projectRoot);\n  if (status === FATAL) {\n    return status;\n  }\n\n  const expStatus = await _validateExpJsonAsync(exp, pkg, projectRoot, allowNetwork);\n  if (expStatus === FATAL) {\n    return expStatus;\n  }\n\n  status = Math.max(status, expStatus);\n\n  if (exp && !exp.ignoreNodeModulesValidation) {\n    let nodeModulesStatus = await _validateNodeModulesAsync(projectRoot);\n    if (nodeModulesStatus > status) {\n      return nodeModulesStatus;\n    }\n  }\n\n  await _validateOptimizedAssetsAsync(projectRoot, {});\n\n  return status;\n}\n\ntype ExpoSdkStatus = 0 | 1 | 2;\n\nexport const EXPO_SDK_INSTALLED_AND_IMPORTED = 0;\nexport const EXPO_SDK_NOT_INSTALLED = 1;\nexport const EXPO_SDK_NOT_IMPORTED = 2;\n\nexport async function getExpoSdkStatus(projectRoot: string): Promise<ExpoSdkStatus> {\n  let { pkg } = await ProjectUtils.readConfigJsonAsync(projectRoot);\n\n  try {\n    let sdkPkg;\n    if (pkg.dependencies['exponent']) {\n      sdkPkg = 'exponent';\n    } else if (pkg.dependencies['expo']) {\n      sdkPkg = 'expo';\n    } else {\n      return EXPO_SDK_NOT_INSTALLED;\n    }\n\n    let mainFilePath = path.join(projectRoot, pkg.main);\n    let mainFile = await fs.readFile(mainFilePath, 'utf8');\n\n    // TODO: support separate .ios.js and .android.js files\n    if (mainFile.includes(`from '${sdkPkg}'`) || mainFile.includes(`require('${sdkPkg}')`)) {\n      return EXPO_SDK_INSTALLED_AND_IMPORTED;\n    } else {\n      return EXPO_SDK_NOT_IMPORTED;\n    }\n  } catch (e) {\n    return EXPO_SDK_NOT_IMPORTED;\n  }\n}\n"],"sourceRoot":"/@expo/xdl@54.1.5/src"}